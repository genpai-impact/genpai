# 7.伤害结算

> 参照需求文档
>
> - [进攻结算流程](https://www.teambition.com/project/61a89798beaeab07a42c799c/works/61c5cc58f516a2003f0cd9c4/work/61d969bcf61b92003feee957)
>
> 整理，最终解释权归原文档所有

　　伤害结算流程可随开发难度调整，当前文档为理想化结算过程

# 逻辑

　　详见：[攻击结算流程](https://www.teambition.com/project/61a89798beaeab07a42c799c/works/61c5cc58f516a2003f0cd9c4/work/61d969bcf61b92003feee957)

　　**当前版本为 v0.0.5 修改**

　　此流程适用于：

1. 怪物进攻/反击
2. 非指向型/指向型魔法牌造成伤害*
3. 非指向型/指向型技能造成伤害*

　　注：

　　标*代表此流程在当前版本没有涉及，但在未来版本将会出现

　　标**代表此流程在还未在设计中出现，但不排除未来版本中出现

　　

## **A **前置自动/次要操作**

　　 选取目标后会立刻进行的 `前置操作` ，完成后再进行**主要操作**的结算。

　　举例：

　　 **前置自动操作 →** 【喷射】：攻击目标前，喷射目标，造成 2 点水元素伤害。

　　 **前置次要操作 →** 【狂风】：每回合开始时，使我方的第一次攻击能额外作用于一个目标，造成 50% 伤害和相同元素效果（次要目标不反击）

## B **面板伤害**

　　此次攻击面板上显示的伤害，面板伤害 = 初始攻击力 + Buff 加成

　　举例：

　　【狂暴】：己方全体目标攻击 +1

　　【精进】：等特性对怪物 ATK 的永久/暂时影响

## *C 过程增/减益

　　本次攻击能够触发的临时增益/减益

　　举例：

　　【再破】：若攻击上回合攻击的同一目标，攻击力 +100%

## **D 元素反应**

　　本次攻击若能触发元素反应，根据对应效果进行计算：

* 增幅反应：进行增伤
* 超导反应：清除护盾护甲

　　储存其他造成额外伤害反应推后结算，见 **H 连锁反应**

## *E 加/减伤增益

　　特性/技能对本次伤害的影响。

　　举例：

　　【易燃】：受到火属性伤害翻倍

　　【大雨】：雷属性伤害 +50%

## *F **额外增**  **/**  **减伤**  **&** **护甲减伤**

　　【脆弱】：受到伤害额外附加 1 点

　　【被动】：受到岩属性伤害额外附加 1 点

　　护甲可以额外减伤

## G **护盾**  **/** **计算伤害**

　　计算得到 **最终伤害** ，执行 **受击** （见需求文档）并根据伤害类型显示本次伤害的造成的伤害量及对应元素颜色，优先扣护盾，随后再扣血，目标血量为 0 进入**死亡结算**等待。

## H **连锁反应**

　　若进攻引入了多段伤害/AOE 伤害，可简化为单体伤害进行依次或并行结算：

　　**单段 AOE 伤害**会依次计算，同时结算，相当于多个单体伤害同时进行。

　　**多段伤害**会依次等候，相当于多段单体伤害排好队一个一个结算。

　　**单段伤害**引起的**单段 AOE 伤害**会成为单段伤害的**子队列**并行等候。

## I **单位影响**

　　由于元素反应/特性，本次操作会触发的其余效果。

　　举例：

　　挂载/消除元素标记，触发冻结/感电/超导等状态

## ***J ****后****置自动操作**

　　结算完**主要操作**后的**后置自动操作**

　　【逆焰之刃】:每次攻击可追加一段 2 点火元素伤害的攻击

　　【重箭】:进行攻击后，下回合无法攻击

　　【精进】:每次攻击后 ATK+1

　　【迅雷】:一回合可以进行两次攻击

　　【被动】:受到火属性伤害附加一层引燃效果

## K **对局影响**

　　进行怪物/角色的 **死亡结算** /随后此时进行一次**游戏结算**判定

## ** **L ****后置****次要操作**

　　待主要结算**伤害队列**清空时，**后置次要操作**开始结算，需要玩家手动进行的下一段操作。

　　举例：

　　【追杀】:若本次攻击击杀目标，选取额外一个目标造成等量伤害

# 细分需求列表

* [ ] 实现伤害结算管理器
