# 1.回合逻辑

> 参照需求文档
>
> - [游戏开始与结束&回合生命周期](https://www.teambition.com/project/61a89798beaeab07a42c799c/works/61c5cc58f516a2003f0cd9c4/work/61c9857eb079f7003fca4c71)
>
> 整理，最终解释权归原文档所有

# 逻辑部分

　　主进程：游戏生命周期

* 生成游戏上下文
  * 生成 Boss、玩家
    * 确定回合优先级
  * 生成 UI 组件
    * 生成 UI 界面
      * 手牌区
      * 牌库区
      * 角色 banner 区
      * boss 计分区、技能区
  * 生成战斗相关管理器
    * 生成战场管理器
    * 生成战场模型（美术）
  * （低优先）生成天气
* 生成回合生命周期
  * 玩家 1 回合
    * 回合前阶段：
      * 角色能量更新（角色单位接收消息）
      * 抽取卡牌（牌堆接收消息）
      * 结算回合开始时 Buff（Buff 对象接收消息）
      * 刷新角色上场 CD（单位接收消息）
      * 重置单位行动（单位接收消息）
      * ···
      * （结算完成进入回合中）
    * 回合中阶段：
      * 玩家行为：
        * 点击手牌申请出牌，点击目标确认出牌，实现召唤/效果
        * 点击单位申请攻击，点击目标确认攻击，实现效果
          * 实现基础攻击、反击
          * 实现 Buff 附加、消除
          * 实现伤害流程 Buff、元素反应的计算&更新
        * 点击更换角色，释放出场技
        * （低优先）点击角色使用技能，点击目标确认技能，实现效果
          * 实现技能类储存与施法选择
          * 实现角色&Boss 技能
      * 系统行为：
        * 对 Boss 造成伤害时更新计分条
        * 单位受到致命伤害时退场（角色自动上场更新精灵球）
      * （玩家点击回合结束按钮结束回合中阶段）
    * 回合后阶段：Buff 结算
      * 弃牌
  * Boss 回合 1
    * 回合前阶段：Buff 结算、Boss 能量更新
    * 回合中阶段：
      * 确认技能释放，对“上一次行动玩家”依地块顺序发起攻击
    * 回合后阶段：Buff 结算
  * 玩家 2 回合：（AI）
    * 回合前阶段：同玩家 1
    * 回合中阶段：流程同玩家 1，AI 通过管理器跳过请求确认阶段直接执行操作
    * 回合后阶段：同玩家 1
  * Boss 回合 2：同 Boss 回合 1
* 进行游戏结束结算：（主进程接收 Boss 死亡、玩家角色全灭消息）
  * 结算获胜条件
  * 生成结算界面

# 细分需求列表
